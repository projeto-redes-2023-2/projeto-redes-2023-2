<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat em Tempo Real</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    #chat-container {
        border: 1px solid #ccc;
        padding: 10px;
        max-width: 400px;
        margin: 0 auto;
        background-color: #fff;
        border-radius: 8px;
    }
    #chat-messages {
        overflow-y: scroll;
        max-height: 300px;
    }
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        background: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #ddd 75%, #ddd),
                    linear-gradient(-45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%, #ddd);
        background-size: 40px 40px;
        background-position: 0 0, 20px 20px;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <label for="roomInput">Escolha uma sala:</label>
    <select id="roomInput"></select>
    <br>
    <div id="chat-messages"></div>
    <input type="text" id="messageInput" placeholder="Digite sua mensagem...">
    <button onclick="sendMessage()">Enviar</button>
  </div>

  <script>
    const socket = new WebSocket("ws://seu-servidor-websocket");

    const chatMessages = document.getElementById("chat-messages");
    const roomInput = document.getElementById("roomInput");
    const messageInput = document.getElementById("messageInput");

    function addMessage(message) {
      const messageElement = document.createElement("div");
      messageElement.textContent = message;
      chatMessages.appendChild(messageElement);
    }

    function sendMessage() {
      const message = messageInput.value;
      const room = roomInput.value;

      if (message.trim() !== "") {
        socket.send(JSON.stringify({ room, message }));
        messageInput.value = "";
      }
    }

    socket.addEventListener("open", (event) => {
      addMessage("Conexão estabelecida.");
    });

    socket.addEventListener("message", (event) => {
      const data = JSON.parse(event.data);
      const { room, message } = data;
      addMessage(`Sala ${room}: ${message}`);
    });

    socket.addEventListener("close", (event) => {
      addMessage("Conexão encerrada.");
    });

    socket.addEventListener("error", (event) => {
      addMessage("Erro na conexão.");
    });

    // Adiciona uma função para atualizar a lista de salas disponíveis
    function updateRoomList(rooms) {
      roomInput.innerHTML = "";
      rooms.forEach(room => {
        const option = document.createElement("option");
        option.value = room;
        option.text = `Sala ${room}`;
        roomInput.add(option);
      });
    }

    // Pede ao servidor a lista de salas disponíveis assim que a conexão WebSocket é estabelecida
    socket.addEventListener("open", () => {
      socket.send(JSON.stringify({ command: "get_rooms" }));
    });

    // Atualiza a lista de salas quando receber uma mensagem do servidor
    socket.addEventListener("message", (event) => {
      const data = JSON.parse(event.data);
      if (data.rooms) {
        updateRoomList(data.rooms);
      }
    });
  </script>
</body>
</html>
